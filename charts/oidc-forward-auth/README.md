# oidc-forward-auth

![Version: 1.3.0](https://img.shields.io/badge/Version-1.3.0-informational?style=flat-square)

Forward Auth proxy with gogatekeeper. It replaces the old proxy mechanism

## Installing the Chart with iits ArgoCD

```yaml
charts:
  oidc-forward-auth:
    namespace: routing
    targetRevision: "1.0.0"
    parameters:
      gatekeeper.config.client-id: "${vault:whatever/data/keycloak/keycloak_proxy_admin#client_id}"
      gatekeeper.config.client-secret: "${vault:whatever/data/keycloak/keycloak_proxy_admin#client_secret}"
      gatekeeper.config.discovery-url: "https://{{.Values.projectValues.authDomain}}/realms/{{.Values.projectValues.context}}"
      ingress.host: "my.protected.domain"
```

## Then use it like this

```yaml
ingress:
  enabled: true
  # -- Mandatory, replace it with your host address
  host:
  annotations:
    traefik.ingress.kubernetes.io/router.entrypoints: websecure
    traefik.ingress.kubernetes.io/router.tls: "true"
    #namespace-name@kubernetescrd
    traefik.ingress.kubernetes.io/router.middlewares: routing-oidc-forward-auth@kubernetescrd
  # Creates default Ingress with tls and the given host from .Values.ingress.host
  defaultIngress:
    enabled: true
```

## Requirements

| Repository | Name | Version |
|------------|------|---------|
| https://gogatekeeper.github.io/helm-gogatekeeper | gatekeeper | 0.1.33 |

## Values

| Key | Type | Default | Description |
|-----|------|---------|-------------|
| gatekeeper.automountServiceAccountToken | bool | `true` |  |
| gatekeeper.config.client-id | string | `nil` | Required |
| gatekeeper.config.client-secret | string | `nil` | Required |
| gatekeeper.config.discovery-url | string | `nil` | Required |
| gatekeeper.config.enable-compression | bool | `true` |  |
| gatekeeper.config.enable-default-deny | bool | `false` |  |
| gatekeeper.config.enable-json-logging | bool | `true` |  |
| gatekeeper.config.enable-logging | bool | `false` |  |
| gatekeeper.config.enable-metrics | bool | `false` |  |
| gatekeeper.config.enable-refresh-tokens | bool | `false` |  |
| gatekeeper.config.enable-request-id | bool | `true` |  |
| gatekeeper.config.enable-token-header | bool | `false` |  |
| gatekeeper.config.listen | string | `"0.0.0.0:3000"` |  |
| gatekeeper.config.listen-admin | string | `":4000"` |  |
| gatekeeper.config.no-proxy | bool | `true` |  |
| gatekeeper.config.no-redirects | bool | `false` |  |
| gatekeeper.config.preserve-host | bool | `true` |  |
| gatekeeper.config.resources[0].require-any-role | bool | `true` |  |
| gatekeeper.config.resources[0].uri | string | `"/*"` |  |
| gatekeeper.config.server-read-timeout | string | `"300s"` |  |
| gatekeeper.config.server-write-timeout | string | `"300s"` |  |
| gatekeeper.config.skip-access-token-clientid-check | bool | `true` |  |
| gatekeeper.extraVolumeMounts[0].mountPath | string | `"/tmp"` |  |
| gatekeeper.extraVolumeMounts[0].name | string | `"oidc-forward-auth-no-permission-link"` |  |
| gatekeeper.extraVolumeMounts[0].readOnly | bool | `true` |  |
| gatekeeper.extraVolumes[0].configMap.defaultMode | int | `511` |  |
| gatekeeper.extraVolumes[0].configMap.name | string | `"oidc-forward-auth-no-permission-link"` |  |
| gatekeeper.extraVolumes[0].name | string | `"oidc-forward-auth-no-permission-link"` |  |
| gatekeeper.replicaCount | int | `1` |  |
| gatekeeper.strategy.type | string | `"RollingUpdate"` |  |
| ingress.annotations."traefik.ingress.kubernetes.io/router.entrypoints" | string | `"websecure"` |  |
| ingress.annotations."traefik.ingress.kubernetes.io/router.tls" | string | `"true"` |  |
| ingress.defaultIngress.backend.name | string | `"{{$.Release.Name}}-gatekeeper"` |  |
| ingress.defaultIngress.backend.port.name | string | `"proxy"` |  |
| ingress.defaultIngress.enabled | bool | `true` |  |
| ingress.defaultIngress.path | string | `"/oauth"` |  |
| ingress.enabled | bool | `true` |  |
| ingress.host | string | `nil` | Required, replace it with your host address |

----------------------------------------------
Autogenerated from chart metadata using [helm-docs v1.13.1](https://github.com/norwoodj/helm-docs/releases/v1.13.1)
