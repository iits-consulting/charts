# kyverno

![Version: 1.3.1](https://img.shields.io/badge/Version-1.3.1-informational?style=flat-square) ![Type: application](https://img.shields.io/badge/Type-application-informational?style=flat-square)

This chart wraps kyverno and some additional components such as the policy reporter as well as
IngressRoutes/Middlewares to allow usage of the Kyverno UI.

## Usage

As kyverno enforces policies in the Kubernetes cluster it makes sense to deploy it at the very
beginning when setting up new infrastructure. We usually deploy essential cluster resources up to
ArgoCD via Terraform. An example of how to deploy a complete Kyverno setup would be:

```
resource "helm_release" "kyverno" {
  name                  = "kyverno"
  repository            = "https://charts.iits.tech"
  version               = "1.1.0"
  namespace             = "kyverno"
  create_namespace      = true
  wait                  = true
  atomic                = true
  timeout               = 900 // 15 Minutes
  render_subchart_notes = true
  dependency_update     = true
  wait_for_jobs         = true
  skip_crds             = false
# The entrypoint to your cluster highly depends on your local setup
  values                = [
    yamlencode({
      route = {
        enabled    = true
        entrypoint = "after-proxy"
      }
    })
  ]
}

resource "helm_release" "iits_kyverno_policies" {
  wait_for_jobs         = true
  depends_on            = [helm_release.kyverno]
  name                  = "iits-kyverno-policies"
  repository            = "https://charts.iits.tech"
  version               = "1.0.0"
  chart                 = "iits-kyverno-policies"
  namespace             = "kyverno"
  create_namespace      = true
  wait                  = true
  atomic                = true
  timeout               = 900 // 15 Minutes
  render_subchart_notes = true
  dependency_update     = true
}
```

## Installing the Chart

To install the chart with the release name kyverno:

```shell
    helm repo add iits-charts https://charts.iits.tech
    helm search repo kyverno
    helm install kyverno iits-charts/kyverno
```

## Requirements

| Repository | Name | Version |
|------------|------|---------|
| https://kyverno.github.io/kyverno/ | kyverno | 2.7.2 |
| https://kyverno.github.io/policy-reporter | policy-reporter | 2.19.0 |

## Values

| Key | Type | Default | Description |
|-----|------|---------|-------------|
| ingress.annotations."cert-manager.io/cluster-issuer" | string | `"letsencrypt"` |  |
| ingress.annotations."traefik.ingress.kubernetes.io/router.entrypoints" | string | `"websecure"` |  |
| ingress.annotations."traefik.ingress.kubernetes.io/router.middlewares" | string | `"{{.Release.Namespace}}-strip-prefix-{{ .Release.Name }}@kubernetescrd, routing-oidc-forward-auth@kubernetescrd"` |  |
| ingress.annotations."traefik.ingress.kubernetes.io/router.tls" | string | `"true"` |  |
| ingress.defaultIngress.enabled | bool | `false` |  |
| ingress.enabled | bool | `true` |  |
| ingress.host | string | `nil` |  |
| ingress.hosts[0].host | string | `"{{.Values.ingress.host}}"` |  |
| ingress.hosts[0].paths[0].backend.name | string | `"{{include \"kyverno.fullname\" $}}-ui"` |  |
| ingress.hosts[0].paths[0].path | string | `"/_nuxt"` |  |
| ingress.hosts[0].paths[1].backend.name | string | `"{{include \"kyverno.fullname\" $}}-ui"` |  |
| ingress.hosts[0].paths[1].path | string | `"/policies"` |  |
| ingress.tls[0].hosts[0] | string | `"{{.Values.ingress.host}}"` |  |
| ingress.tls[0].secretName | string | `"kyverno-cert"` |  |
| kyverno.existingImagePullSecrets | list | `[]` |  |
| kyverno.extraArgs[0] | string | `"--loggingFormat=text"` |  |
| kyverno.extraArgs[1] | string | `"--exceptionNamespace={{ include \"kyverno.namespace\" . }}"` |  |
| kyverno.extraArgs[2] | string | `"--enablePolicyException=true"` |  |
| kyverno.grafana.enabled | bool | `true` |  |
| kyverno.grafana.namespace | string | `"monitoring"` |  |
| kyverno.installCRDs | bool | `true` |  |
| kyverno.serviceMonitor.enabled | bool | `true` |  |
| policy-reporter.install | bool | `true` |  |
| policy-reporter.kyvernoPlugin.enabled | bool | `true` |  |
| policy-reporter.ui.enabled | bool | `true` |  |
| policy-reporter.ui.plugins.kyverno | bool | `true` |  |

<img src="https://iits-consulting.de/wp-content/uploads/2021/08/iits-logo-2021-red-square-xl.png"
alt="iits consulting" id="logo" width="200" height="200">
<br>
*This chart is provided by [iits-consulting](https://iits-consulting.de/) - your Cloud-Native Innovation Teams as a Service!*

----------------------------------------------
Autogenerated from chart metadata using [helm-docs v1.12.0](https://github.com/norwoodj/helm-docs/releases/v1.12.0)